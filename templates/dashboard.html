<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Merchant Shield | Fraud Detection Dashboard</title>
    <meta name="description" content="Real-time fraud detection and transaction monitoring for e-commerce merchants">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-brand">
            <div class="nav-logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <rect width="32" height="32" rx="8" fill="url(#shield-gradient)" />
                    <path d="M16 6L8 10V16C8 21.52 11.48 26.74 16 28C20.52 26.74 24 21.52 24 16V10L16 6Z" stroke="white"
                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M12 16L14.5 18.5L20 13" stroke="white" stroke-width="1.5" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <defs>
                        <linearGradient id="shield-gradient" x1="0" y1="0" x2="32" y2="32"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="#6366F1" />
                            <stop offset="1" stop-color="#8B5CF6" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <span class="nav-title">Merchant Shield</span>
            <span class="nav-badge">BETA</span>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-link active">Dashboard</a>
            <a href="/analyze" class="nav-link">Analyze</a>
            <a href="/audit" class="nav-link">Audit Log</a>
        </div>
        <div class="nav-status">
            <div class="status-indicator" id="threatIndicator">
                <span class="status-dot"></span>
                <span class="status-text">Monitoring</span>
            </div>
            <div class="ws-status ws-status-disconnected" id="wsConnectionStatus">
                <span class="ws-status-dot"></span>
                <span class="ws-status-text">Connecting...</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Header Section -->
        <header class="header">
            <div class="header-content">
                <h1 class="header-title">Fraud Detection Center</h1>
                <p class="header-subtitle">Real-time transaction monitoring and risk assessment</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="refreshData()">
                    <svg class="btn-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                            clip-rule="evenodd" />
                    </svg>
                    Refresh
                </button>
                <button class="btn btn-primary" onclick="window.location.href='/analyze'">
                    <svg class="btn-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                            clip-rule="evenodd" />
                    </svg>
                    New Analysis
                </button>
            </div>
        </header>

        <!-- Stats Grid -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Total Transactions</span>
                    <div class="stat-icon stat-icon-blue">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                            <path fill-rule="evenodd"
                                d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>
                <div class="stat-value" id="statTotal">--</div>
                <div class="stat-trend stat-trend-up">
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z"
                            clip-rule="evenodd" />
                    </svg>
                    <span>+12% from last hour</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Flagged</span>
                    <div class="stat-icon stat-icon-yellow">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>
                <div class="stat-value stat-value-yellow" id="statFlagged">--</div>
                <div class="stat-subtext">Requires review</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Blocked</span>
                    <div class="stat-icon stat-icon-red">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>
                <div class="stat-value stat-value-red" id="statBlocked">--</div>
                <div class="stat-subtext">High-risk blocked</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Amount at Risk</span>
                    <div class="stat-icon stat-icon-purple">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z" />
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>
                <div class="stat-value stat-value-purple" id="statAmountAtRisk">--</div>
                <div class="stat-subtext">Protected this session</div>
            </div>
        </section>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid-extended">
            <!-- Fraud Network Graph -->
            <section class="card card-large">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M17.778 8.222c-4.296-4.296-11.26-4.296-15.556 0A1 1 0 01.808 6.808c5.076-5.077 13.308-5.077 18.384 0a1 1 0 01-1.414 1.414zM14.95 11.05a7 7 0 00-9.9 0 1 1 0 01-1.414-1.414 9 9 0 0112.728 0 1 1 0 01-1.414 1.414zM12.12 13.88a3 3 0 00-4.242 0 1 1 0 01-1.415-1.415 5 5 0 017.072 0 1 1 0 01-1.415 1.415zM9 16a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                        Fraud Network
                    </h2>
                    <div class="card-header-actions">
                        <div id="networkStats" class="network-stats"></div>
                        <button class="btn-icon-only"
                            onclick="window.fraudNetwork && window.fraudNetwork.filterFraudOnly()"
                            title="Show Fraud Only">
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <button class="btn-icon-only" onclick="window.fraudNetwork && window.fraudNetwork.resetFilter()"
                            title="Reset View">
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="card-body card-body-flush">
                    <div class="network-container" id="fraudNetwork">
                        <div class="network-loading">
                            <div class="spinner"></div>
                            <span>Building fraud network...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recent Transactions (Live Feed) -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                        Live Transactions
                        <span class="live-badge">LIVE</span>
                    </h2>
                    <a href="/audit" class="card-link">View All →</a>
                </div>
                <div class="card-body card-body-flush">
                    <div class="transaction-list transaction-list-live" id="transactionList">
                        <div class="transaction-loading">
                            <div class="spinner"></div>
                            <span>Connecting to live feed...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Risk Distribution -->
            <section class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" />
                        </svg>
                        Risk Distribution
                    </h2>
                </div>
                <div class="card-body">
                    <div class="risk-chart" id="riskChart">
                        <div class="risk-bar-container">
                            <div class="risk-bar risk-bar-low" id="riskBarLow" style="width: 0%"></div>
                            <div class="risk-bar risk-bar-medium" id="riskBarMedium" style="width: 0%"></div>
                            <div class="risk-bar risk-bar-high" id="riskBarHigh" style="width: 0%"></div>
                        </div>
                        <div class="risk-legend">
                            <div class="risk-legend-item">
                                <span class="risk-dot risk-dot-low"></span>
                                <span>Low Risk</span>
                                <span class="risk-percent" id="riskPercentLow">--%</span>
                            </div>
                            <div class="risk-legend-item">
                                <span class="risk-dot risk-dot-medium"></span>
                                <span>Medium Risk</span>
                                <span class="risk-percent" id="riskPercentMedium">--%</span>
                            </div>
                            <div class="risk-legend-item">
                                <span class="risk-dot risk-dot-high"></span>
                                <span>High Risk</span>
                                <span class="risk-percent" id="riskPercentHigh">--%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Fraud Time Machine -->
            <section class="time-machine-card">
                <div class="time-machine-header">
                    <h2 class="time-machine-title">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                                clip-rule="evenodd" />
                        </svg>
                        Fraud Time Machine
                        <span class="time-machine-badge">Temporal Analysis</span>
                    </h2>
                    <div class="velocity-indicator" id="velocityIndicator">
                        <span class="velocity-label">Fraud Velocity</span>
                        <div class="velocity-bar">
                            <div class="velocity-fill low" id="velocityFill"></div>
                        </div>
                        <span class="velocity-value" id="velocityValue">0.2x</span>
                    </div>
                </div>

                <!-- Time Axis -->
                <div class="time-axis">
                    <span class="time-axis-label">00:00</span>
                    <span class="time-axis-label">06:00</span>
                    <span class="time-axis-label">12:00</span>
                    <span class="time-axis-label">18:00</span>
                    <span class="time-axis-label">24:00</span>
                    <span class="time-axis-label">30:00</span>
                    <span class="time-axis-label">36:00</span>
                    <span class="time-axis-label">42:00</span>
                    <span class="time-axis-label">48:00</span>
                </div>

                <!-- Temporal Heatmap -->
                <div class="temporal-heatmap">
                    <div class="heatmap-timeline" id="temporalHeatmap">
                        <!-- Will be populated by JavaScript -->
                        <div class="heatmap-row-labeled">
                            <span class="heatmap-label">Loading...</span>
                            <div class="heatmap-cells">
                                <div class="heatmap-cell-enhanced skeleton-node" style="animation-delay: 0s"></div>
                                <div class="heatmap-cell-enhanced skeleton-node" style="animation-delay: 0.1s"></div>
                                <div class="heatmap-cell-enhanced skeleton-node" style="animation-delay: 0.2s"></div>
                                <div class="heatmap-cell-enhanced skeleton-node" style="animation-delay: 0.3s"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Heatmap Legend -->
                <div class="heatmap-legend-compact">
                    <div class="legend-scale">
                        <span class="legend-scale-label">Safe</span>
                        <div class="legend-scale-bar"></div>
                        <span class="legend-scale-label">Critical</span>
                    </div>
                </div>

                <!-- Detected Fraud Sessions -->
                <div class="sessions-container">
                    <div class="sessions-header">
                        <span class="sessions-title">Detected Attack Windows</span>
                        <span class="sessions-count" id="sessionsCount">0</span>
                    </div>
                    <div class="sessions-list" id="sessionsList">
                        <!-- Will be populated by JavaScript -->
                        <div class="session-card">
                            <div class="session-icon">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="session-info">
                                <div class="session-title">Loading fraud sessions...</div>
                                <div class="session-meta">
                                    <span class="session-stat">Analyzing temporal patterns</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <span>© 2024 Merchant Shield</span>
            <span class="footer-divider">•</span>
            <span>Fraud Detection API v1.0</span>
            <span class="footer-divider">•</span>
            <span id="lastUpdate">Last updated: --</span>
        </div>
    </footer>

    <!-- Toast Container for Fraud Alerts -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Alert Sound (optional) -->
    <audio id="alertSound" preload="auto">
        <source src="{{ url_for('static', filename='sounds/alert.mp3') }}" type="audio/mpeg">
    </audio>

    <!-- Socket.IO Client Library -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="{{ url_for('static', filename='network.js') }}"></script>
    <script src="{{ url_for('static', filename='temporal.js') }}"></script>
    <script src="{{ url_for('static', filename='realtime.js') }}"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>